<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ordre de Mission â€“ BÃ©nÃ©voles</title>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:linear-gradient(135deg,#6b6fdc,#7e5bc4);
}
.container{
  max-width:900px;
  margin:40px auto;
  background:#fff;
  border-radius:20px;
  padding:30px;
}
header{
  text-align:center;
  margin-bottom:30px;
}
header h1{margin:0;}
.admin-btn{
  float:right;
  border:1px solid #ccc;
  background:#fff;
  border-radius:20px;
  padding:6px 12px;
  cursor:pointer;
}
h2{margin-top:30px;}
input,select{
  width:100%;
  padding:10px;
  margin-top:5px;
  margin-bottom:15px;
}
.total{
  background:linear-gradient(135deg,#6b6fdc,#7e5bc4);
  color:#fff;
  text-align:center;
  padding:20px;
  border-radius:15px;
  font-size:24px;
  margin-top:10px;
}
button.submit{
  width:100%;
  padding:15px;
  font-size:18px;
  border:none;
  border-radius:12px;
  background:#6b6fdc;
  color:#fff;
  cursor:pointer;
}
.admin-only{display:none;}
body.admin-mode .admin-only{display:block;}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
  text-align:left;
}
</style>
</head>

<body>

<div class="container">
<header>
  <button id="adminBtn" class="admin-btn">ðŸ”’ Admin</button>
  <h1>ðŸŽ¯ Ordre de Mission â€“ BÃ©nÃ©voles</h1>
  <p>Ligue de Tir Languedoc Roussillon</p>
</header>

<form id="missionForm">
  <h2>Informations de la mission</h2>

  <label>Objet de la mission *</label>
  <input required id="objet">

  <label>Date de la mission *</label>
  <input type="date" required id="date">

  <h2>Informations personnelles</h2>

  <label>Nom *</label>
  <input required id="nom">

  <label>PrÃ©nom *</label>
  <input required id="prenom">

  <label>Adresse *</label>
  <input required id="adresse">

  <h2>PrÃ©sence bÃ©nÃ©vole</h2>

  <label>Nombre de jours (1 Ã  3)</label>
  <select id="jours">
    <option value="1">1 jour</option>
    <option value="2">2 jours</option>
    <option value="3">3 jours</option>
  </select>

  <div class="total">
    INDEMNITÃ‰ TOTALE<br>
    <span id="total">30,00 â‚¬</span>
  </div>

  <button class="submit" type="submit">ðŸ“„ GÃ©nÃ©rer & Envoyer</button>
</form>

<!-- HISTORIQUE ADMIN -->
<div class="admin-only">
  <h2>Historique des missions</h2>
  <table>
    <thead>
      <tr><th>Date</th><th>Nom</th><th>Objet</th><th>Total</th></tr>
    </thead>
    <tbody id="history"></tbody>
  </table>
</div>
</div>

<script>
/* ========= CONFIG ========= */
const ADMIN_CODE = "2409";               // ton code admin
const EMAIL_DEST = "webjuws66@gmail.com"; // ADRESSE DE TEST
emailjs.init("PUBLIC_KEY_ICI");

/* ========= CALCUL ========= */
const jours = document.getElementById("jours");
const totalSpan = document.getElementById("total");

jours.addEventListener("change", () => {
  totalSpan.textContent = (jours.value * 30).toFixed(2).replace(".", ",") + " â‚¬";
});

/* ========= ADMIN ========= */
document.getElementById("adminBtn").onclick = () => {
  const code = prompt("Code administrateur");
  if (code === ADMIN_CODE) {
    document.body.classList.add("admin-mode");
    loadHistory();
  } else if (code !== null) {
    alert("Code incorrect");
  }
};

/* ========= FORM ========= */
document.getElementById("missionForm").addEventListener("submit", e => {
  e.preventDefault();

  const data = {
    objet: objet.value,
    date: date.value,
    nom: nom.value,
    prenom: prenom.value,
    adresse: adresse.value,
    jours: jours.value,
    total: jours.value * 30
  };

  saveHistory(data);

  emailjs.send("SERVICE_ID","TEMPLATE_ID",{
    to_email: EMAIL_DEST,
    message: `
Mission bÃ©nÃ©vole
${data.prenom} ${data.nom}
Objet : ${data.objet}
Date : ${data.date}
Jours : ${data.jours}
Total : ${data.total} â‚¬
`
  }).then(()=>{
    alert("Mission envoyÃ©e");
  });
});

/* ========= HISTORIQUE ========= */
function saveHistory(d){
  const h = JSON.parse(localStorage.getItem("missions")||"[]");
  h.push(d);
  localStorage.setItem("missions",JSON.stringify(h));
}

function loadHistory(){
  const h = JSON.parse(localStorage.getItem("missions")||"[]");
  const tbody = document.getElementById("history");
  tbody.innerHTML="";
  h.forEach(m=>{
    tbody.innerHTML+=`<tr>
      <td>${m.date}</td>
      <td>${m.prenom} ${m.nom}</td>
      <td>${m.objet}</td>
      <td>${m.total} â‚¬</td>
    </tr>`;
  });
}
</script>

</body>
</html>
